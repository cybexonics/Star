"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/billing/route";
exports.ids = ["app/api/billing/route"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fbilling%2Froute&page=%2Fapi%2Fbilling%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbilling%2Froute.ts&appDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fbilling%2Froute&page=%2Fapi%2Fbilling%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbilling%2Froute.ts&appDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_akash_OneDrive_Desktop_Star_src_app_api_billing_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/billing/route.ts */ \"(rsc)/./src/app/api/billing/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/billing/route\",\n        pathname: \"/api/billing\",\n        filename: \"route\",\n        bundlePath: \"app/api/billing/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\akash\\\\OneDrive\\\\Desktop\\\\Star\\\\src\\\\app\\\\api\\\\billing\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_akash_OneDrive_Desktop_Star_src_app_api_billing_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/billing/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZiaWxsaW5nJTJGcm91dGUmcGFnZT0lMkZhcGklMkZiaWxsaW5nJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYmlsbGluZyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNha2FzaCU1Q09uZURyaXZlJTVDRGVza3RvcCU1Q1N0YXIlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q2FrYXNoJTVDT25lRHJpdmUlNUNEZXNrdG9wJTVDU3RhciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDMkI7QUFDeEc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdGFyLXRhaWxvcnMvPzJmZWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcYWthc2hcXFxcT25lRHJpdmVcXFxcRGVza3RvcFxcXFxTdGFyXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGJpbGxpbmdcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2JpbGxpbmcvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9iaWxsaW5nXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9iaWxsaW5nL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcYWthc2hcXFxcT25lRHJpdmVcXFxcRGVza3RvcFxcXFxTdGFyXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGJpbGxpbmdcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2JpbGxpbmcvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fbilling%2Froute&page=%2Fapi%2Fbilling%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbilling%2Froute.ts&appDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/billing/route.ts":
/*!**************************************!*\
  !*** ./src/app/api/billing/route.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./src/lib/mongodb.ts\");\n/* harmony import */ var _lib_mockData__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/mockData */ \"(rsc)/./src/lib/mockData.ts\");\n\n\n\nasync function POST(request) {\n    try {\n        const client = await _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\n        const db = client.db(\"star-tailors\");\n        const body = await request.json();\n        // Validate required fields\n        if (!body.customerName || !body.phone || !body.garmentType || !body.quantity || !body.rate) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Missing required fields\"\n            }, {\n                status: 400\n            });\n        }\n        // Calculate subtotal and balance\n        const subtotal = body.quantity * body.rate;\n        const balance = subtotal - (body.advance || 0);\n        const billData = {\n            ...body,\n            subtotal,\n            balance,\n            status: \"pending\",\n            createdAt: new Date(),\n            updatedAt: new Date()\n        };\n        const billResult = await db.collection(\"bills\").insertOne(billData);\n        const bill = {\n            ...billData,\n            _id: billResult.insertedId\n        };\n        // Automatically create workflow entry\n        const workflowData = {\n            billId: bill._id.toString(),\n            customerName: bill.customerName,\n            stage: \"cutting\",\n            createdAt: new Date(),\n            updatedAt: new Date()\n        };\n        const workflowResult = await db.collection(\"workflow\").insertOne(workflowData);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: bill\n        }, {\n            status: 201\n        });\n    } catch (error) {\n        console.error(\"Error creating bill:\", error);\n        // Fallback to mock data\n        try {\n            const body = await request.json();\n            // Validate required fields\n            if (!body.customerName || !body.phone || !body.garmentType || !body.quantity || !body.rate) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    error: \"Missing required fields\"\n                }, {\n                    status: 400\n                });\n            }\n            // Calculate subtotal and balance\n            const subtotal = body.quantity * body.rate;\n            const balance = subtotal - (body.advance || 0);\n            const billData = {\n                ...body,\n                subtotal,\n                balance,\n                status: \"pending\",\n                dueDate: new Date(body.dueDate),\n                images: body.images || [],\n                drawings: body.drawings || []\n            };\n            const bill = _lib_mockData__WEBPACK_IMPORTED_MODULE_2__.mockDataStore.createBill(billData);\n            // Automatically create workflow entry\n            const workflow = _lib_mockData__WEBPACK_IMPORTED_MODULE_2__.mockDataStore.createWorkflow({\n                billId: bill._id,\n                customerName: bill.customerName,\n                stage: \"cutting\"\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: bill\n            }, {\n                status: 201\n            });\n        } catch (mockError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: mockError.message\n            }, {\n                status: 500\n            });\n        }\n    }\n}\nasync function GET(request) {\n    try {\n        const client = await _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\n        const db = client.db(\"star-tailors\");\n        const { searchParams } = new URL(request.url);\n        const page = parseInt(searchParams.get(\"page\") || \"1\");\n        const limit = parseInt(searchParams.get(\"limit\") || \"10\");\n        const search = searchParams.get(\"search\") || \"\";\n        let query = {};\n        if (search) {\n            query = {\n                $or: [\n                    {\n                        customerName: {\n                            $regex: search,\n                            $options: \"i\"\n                        }\n                    },\n                    {\n                        phone: {\n                            $regex: search,\n                            $options: \"i\"\n                        }\n                    }\n                ]\n            };\n        }\n        const bills = await db.collection(\"bills\").find(query).sort({\n            createdAt: -1\n        }).limit(limit * 1).skip((page - 1) * limit).toArray();\n        const total = await db.collection(\"bills\").countDocuments(query);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: {\n                bills,\n                pagination: {\n                    page,\n                    limit,\n                    total,\n                    pages: Math.ceil(total / limit)\n                }\n            }\n        });\n    } catch (error) {\n        console.error(\"Error fetching bills:\", error);\n        // Fallback to mock data\n        try {\n            const { searchParams } = new URL(request.url);\n            const page = parseInt(searchParams.get(\"page\") || \"1\");\n            const limit = parseInt(searchParams.get(\"limit\") || \"10\");\n            const search = searchParams.get(\"search\") || \"\";\n            let query = {};\n            if (search) {\n                query = {\n                    $or: [\n                        {\n                            customerName: {\n                                $regex: search,\n                                $options: \"i\"\n                            }\n                        },\n                        {\n                            phone: {\n                                $regex: search,\n                                $options: \"i\"\n                            }\n                        }\n                    ]\n                };\n            }\n            const bills = _lib_mockData__WEBPACK_IMPORTED_MODULE_2__.mockDataStore.getBills(query, {\n                skip: (page - 1) * limit,\n                limit: limit\n            });\n            const total = _lib_mockData__WEBPACK_IMPORTED_MODULE_2__.mockDataStore.countBills(query);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                data: {\n                    bills,\n                    pagination: {\n                        page,\n                        limit,\n                        total,\n                        pages: Math.ceil(total / limit)\n                    }\n                }\n            });\n        } catch (mockError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: mockError.message\n            }, {\n                status: 500\n            });\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTO2dCQUNUcUIsTUFBTTtvQkFDSnVCO29CQUNBTyxZQUFZO3dCQUNWaEI7d0JBQ0FHO3dCQUNBVzt3QkFDQUcsT0FBT0MsS0FBS0MsSUFBSSxDQUFDTCxRQUFRWDtvQkFDM0I7Z0JBQ0Y7WUFDRjtRQUVGLEVBQUUsT0FBT1QsV0FBZ0I7WUFDdkIsT0FBTzNDLHFEQUFZQSxDQUFDUSxJQUFJLENBQ3RCO2dCQUFFTSxTQUFTO2dCQUFPQyxPQUFPNEIsVUFBVUMsT0FBTztZQUFDLEdBQzNDO2dCQUFFNUIsUUFBUTtZQUFJO1FBRWxCO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3N0YXItdGFpbG9ycy8uL3NyYy9hcHAvYXBpL2JpbGxpbmcvcm91dGUudHM/MDU4MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tICdAL2xpYi9tb25nb2RiJztcclxuaW1wb3J0IHsgT2JqZWN0SWQgfSBmcm9tICdtb25nb2RiJztcclxuaW1wb3J0IHsgbW9ja0RhdGFTdG9yZSB9IGZyb20gJ0AvbGliL21vY2tEYXRhJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNsaWVudFByb21pc2U7XHJcbiAgICBjb25zdCBkYiA9IGNsaWVudC5kYignc3Rhci10YWlsb3JzJyk7XHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBcclxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xyXG4gICAgaWYgKCFib2R5LmN1c3RvbWVyTmFtZSB8fCAhYm9keS5waG9uZSB8fCAhYm9keS5nYXJtZW50VHlwZSB8fCAhYm9keS5xdWFudGl0eSB8fCAhYm9keS5yYXRlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDYWxjdWxhdGUgc3VidG90YWwgYW5kIGJhbGFuY2VcclxuICAgIGNvbnN0IHN1YnRvdGFsID0gYm9keS5xdWFudGl0eSAqIGJvZHkucmF0ZTtcclxuICAgIGNvbnN0IGJhbGFuY2UgPSBzdWJ0b3RhbCAtIChib2R5LmFkdmFuY2UgfHwgMCk7XHJcbiAgICBcclxuICAgIGNvbnN0IGJpbGxEYXRhID0ge1xyXG4gICAgICAuLi5ib2R5LFxyXG4gICAgICBzdWJ0b3RhbCxcclxuICAgICAgYmFsYW5jZSxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBjb25zdCBiaWxsUmVzdWx0ID0gYXdhaXQgZGIuY29sbGVjdGlvbignYmlsbHMnKS5pbnNlcnRPbmUoYmlsbERhdGEpO1xyXG4gICAgY29uc3QgYmlsbCA9IHsgLi4uYmlsbERhdGEsIF9pZDogYmlsbFJlc3VsdC5pbnNlcnRlZElkIH07XHJcbiAgICBcclxuICAgIC8vIEF1dG9tYXRpY2FsbHkgY3JlYXRlIHdvcmtmbG93IGVudHJ5XHJcbiAgICBjb25zdCB3b3JrZmxvd0RhdGEgPSB7XHJcbiAgICAgIGJpbGxJZDogYmlsbC5faWQudG9TdHJpbmcoKSxcclxuICAgICAgY3VzdG9tZXJOYW1lOiBiaWxsLmN1c3RvbWVyTmFtZSxcclxuICAgICAgc3RhZ2U6ICdjdXR0aW5nJyxcclxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IHdvcmtmbG93UmVzdWx0ID0gYXdhaXQgZGIuY29sbGVjdGlvbignd29ya2Zsb3cnKS5pbnNlcnRPbmUod29ya2Zsb3dEYXRhKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsIFxyXG4gICAgICBkYXRhOiBiaWxsXHJcbiAgICB9LCB7IHN0YXR1czogMjAxIH0pO1xyXG4gICAgXHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgYmlsbDonLCBlcnJvcik7XHJcbiAgICBcclxuICAgIC8vIEZhbGxiYWNrIHRvIG1vY2sgZGF0YVxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG4gICAgICBcclxuICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXHJcbiAgICAgIGlmICghYm9keS5jdXN0b21lck5hbWUgfHwgIWJvZHkucGhvbmUgfHwgIWJvZHkuZ2FybWVudFR5cGUgfHwgIWJvZHkucXVhbnRpdHkgfHwgIWJvZHkucmF0ZSkge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWlzc2luZyByZXF1aXJlZCBmaWVsZHMnIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBDYWxjdWxhdGUgc3VidG90YWwgYW5kIGJhbGFuY2VcclxuICAgICAgY29uc3Qgc3VidG90YWwgPSBib2R5LnF1YW50aXR5ICogYm9keS5yYXRlO1xyXG4gICAgICBjb25zdCBiYWxhbmNlID0gc3VidG90YWwgLSAoYm9keS5hZHZhbmNlIHx8IDApO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgYmlsbERhdGEgPSB7XHJcbiAgICAgICAgLi4uYm9keSxcclxuICAgICAgICBzdWJ0b3RhbCxcclxuICAgICAgICBiYWxhbmNlLFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnIGFzIGNvbnN0LFxyXG4gICAgICAgIGR1ZURhdGU6IG5ldyBEYXRlKGJvZHkuZHVlRGF0ZSksXHJcbiAgICAgICAgaW1hZ2VzOiBib2R5LmltYWdlcyB8fCBbXSxcclxuICAgICAgICBkcmF3aW5nczogYm9keS5kcmF3aW5ncyB8fCBbXVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgYmlsbCA9IG1vY2tEYXRhU3RvcmUuY3JlYXRlQmlsbChiaWxsRGF0YSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBBdXRvbWF0aWNhbGx5IGNyZWF0ZSB3b3JrZmxvdyBlbnRyeVxyXG4gICAgICBjb25zdCB3b3JrZmxvdyA9IG1vY2tEYXRhU3RvcmUuY3JlYXRlV29ya2Zsb3coe1xyXG4gICAgICAgIGJpbGxJZDogYmlsbC5faWQsXHJcbiAgICAgICAgY3VzdG9tZXJOYW1lOiBiaWxsLmN1c3RvbWVyTmFtZSxcclxuICAgICAgICBzdGFnZTogJ2N1dHRpbmcnXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSwgXHJcbiAgICAgICAgZGF0YTogYmlsbCBcclxuICAgICAgfSwgeyBzdGF0dXM6IDIwMSB9KTtcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChtb2NrRXJyb3I6IGFueSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IG1vY2tFcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNsaWVudFByb21pc2U7XHJcbiAgICBjb25zdCBkYiA9IGNsaWVudC5kYignc3Rhci10YWlsb3JzJyk7XHJcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgncGFnZScpIHx8ICcxJyk7XHJcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzEwJyk7XHJcbiAgICBjb25zdCBzZWFyY2ggPSBzZWFyY2hQYXJhbXMuZ2V0KCdzZWFyY2gnKSB8fCAnJztcclxuICAgIFxyXG4gICAgbGV0IHF1ZXJ5OiBhbnkgPSB7fTtcclxuICAgIGlmIChzZWFyY2gpIHtcclxuICAgICAgcXVlcnkgPSB7XHJcbiAgICAgICAgJG9yOiBbXHJcbiAgICAgICAgICB7IGN1c3RvbWVyTmFtZTogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXHJcbiAgICAgICAgICB7IHBob25lOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfVxyXG4gICAgICAgIF1cclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgYmlsbHMgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdiaWxscycpLmZpbmQocXVlcnkpXHJcbiAgICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxyXG4gICAgICAubGltaXQobGltaXQgKiAxKVxyXG4gICAgICAuc2tpcCgocGFnZSAtIDEpICogbGltaXQpXHJcbiAgICAgIC50b0FycmF5KCk7XHJcbiAgICBcclxuICAgIGNvbnN0IHRvdGFsID0gYXdhaXQgZGIuY29sbGVjdGlvbignYmlsbHMnKS5jb3VudERvY3VtZW50cyhxdWVyeSk7XHJcbiAgICBcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBiaWxscyxcclxuICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICBwYWdlLFxyXG4gICAgICAgICAgbGltaXQsXHJcbiAgICAgICAgICB0b3RhbCxcclxuICAgICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBsaW1pdClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYmlsbHM6JywgZXJyb3IpO1xyXG4gICAgXHJcbiAgICAvLyBGYWxsYmFjayB0byBtb2NrIGRhdGFcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICAgICAgY29uc3QgcGFnZSA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ3BhZ2UnKSB8fCAnMScpO1xyXG4gICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzEwJyk7XHJcbiAgICAgIGNvbnN0IHNlYXJjaCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3NlYXJjaCcpIHx8ICcnO1xyXG4gICAgICBcclxuICAgICAgbGV0IHF1ZXJ5ID0ge307XHJcbiAgICAgIGlmIChzZWFyY2gpIHtcclxuICAgICAgICBxdWVyeSA9IHtcclxuICAgICAgICAgICRvcjogW1xyXG4gICAgICAgICAgICB7IGN1c3RvbWVyTmFtZTogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXHJcbiAgICAgICAgICAgIHsgcGhvbmU6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9XHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc3QgYmlsbHMgPSBtb2NrRGF0YVN0b3JlLmdldEJpbGxzKHF1ZXJ5LCB7XHJcbiAgICAgICAgc2tpcDogKHBhZ2UgLSAxKSAqIGxpbWl0LFxyXG4gICAgICAgIGxpbWl0OiBsaW1pdFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHRvdGFsID0gbW9ja0RhdGFTdG9yZS5jb3VudEJpbGxzKHF1ZXJ5KTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBiaWxscyxcclxuICAgICAgICAgIHBhZ2luYXRpb246IHtcclxuICAgICAgICAgICAgcGFnZSxcclxuICAgICAgICAgICAgbGltaXQsXHJcbiAgICAgICAgICAgIHRvdGFsLFxyXG4gICAgICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChtb2NrRXJyb3I6IGFueSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IG1vY2tFcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNsaWVudFByb21pc2UiLCJtb2NrRGF0YVN0b3JlIiwiUE9TVCIsInJlcXVlc3QiLCJjbGllbnQiLCJkYiIsImJvZHkiLCJqc29uIiwiY3VzdG9tZXJOYW1lIiwicGhvbmUiLCJnYXJtZW50VHlwZSIsInF1YW50aXR5IiwicmF0ZSIsInN1Y2Nlc3MiLCJlcnJvciIsInN0YXR1cyIsInN1YnRvdGFsIiwiYmFsYW5jZSIsImFkdmFuY2UiLCJiaWxsRGF0YSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ1cGRhdGVkQXQiLCJiaWxsUmVzdWx0IiwiY29sbGVjdGlvbiIsImluc2VydE9uZSIsImJpbGwiLCJfaWQiLCJpbnNlcnRlZElkIiwid29ya2Zsb3dEYXRhIiwiYmlsbElkIiwidG9TdHJpbmciLCJzdGFnZSIsIndvcmtmbG93UmVzdWx0IiwiZGF0YSIsImNvbnNvbGUiLCJkdWVEYXRlIiwiaW1hZ2VzIiwiZHJhd2luZ3MiLCJjcmVhdGVCaWxsIiwid29ya2Zsb3ciLCJjcmVhdGVXb3JrZmxvdyIsIm1vY2tFcnJvciIsIm1lc3NhZ2UiLCJHRVQiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJwYWdlIiwicGFyc2VJbnQiLCJnZXQiLCJsaW1pdCIsInNlYXJjaCIsInF1ZXJ5IiwiJG9yIiwiJHJlZ2V4IiwiJG9wdGlvbnMiLCJiaWxscyIsImZpbmQiLCJzb3J0Iiwic2tpcCIsInRvQXJyYXkiLCJ0b3RhbCIsImNvdW50RG9jdW1lbnRzIiwicGFnaW5hdGlvbiIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJnZXRCaWxscyIsImNvdW50QmlsbHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/billing/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/mockData.ts":
/*!*****************************!*\
  !*** ./src/lib/mockData.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   mockDataStore: () => (/* binding */ mockDataStore)\n/* harmony export */ });\n// Mock data store for development/testing when MongoDB is not available\nclass MockDataStore {\n    // Initialize with some sample data\n    constructor(){\n        this.bills = [];\n        this.workflows = [];\n        this.billCounter = 1;\n        this.workflowCounter = 1;\n        this.initializeSampleData();\n    }\n    initializeSampleData() {\n        // Sample bills\n        const sampleBills = [\n            {\n                _id: \"1\",\n                customerName: \"John Doe\",\n                phone: \"+91 9876543210\",\n                garmentType: \"shirt\",\n                quantity: 2,\n                rate: 800,\n                subtotal: 1600,\n                advance: 500,\n                balance: 1100,\n                status: \"pending\",\n                dueDate: new Date(\"2024-01-15\"),\n                measurements: {\n                    length: 30,\n                    shoulder: 18,\n                    sleeve: 24,\n                    chest: 40\n                },\n                images: [],\n                drawings: [],\n                createdAt: new Date(\"2024-01-01\"),\n                updatedAt: new Date(\"2024-01-01\")\n            },\n            {\n                _id: \"2\",\n                customerName: \"Jane Smith\",\n                phone: \"+91 8765432109\",\n                garmentType: \"dress\",\n                quantity: 1,\n                rate: 1200,\n                subtotal: 1200,\n                advance: 600,\n                balance: 600,\n                status: \"in-progress\",\n                dueDate: new Date(\"2024-01-20\"),\n                measurements: {\n                    length: 42,\n                    chest: 36,\n                    waist: 28,\n                    hips: 38\n                },\n                images: [],\n                drawings: [],\n                createdAt: new Date(\"2024-01-02\"),\n                updatedAt: new Date(\"2024-01-02\")\n            }\n        ];\n        // Sample workflows\n        const sampleWorkflows = [\n            {\n                _id: \"1\",\n                billId: \"1\",\n                customerName: \"John Doe\",\n                stage: \"cutting\",\n                createdAt: new Date(\"2024-01-01\"),\n                updatedAt: new Date(\"2024-01-01\")\n            },\n            {\n                _id: \"2\",\n                billId: \"2\",\n                customerName: \"Jane Smith\",\n                stage: \"stitching\",\n                createdAt: new Date(\"2024-01-02\"),\n                updatedAt: new Date(\"2024-01-02\")\n            }\n        ];\n        this.bills = sampleBills;\n        this.workflows = sampleWorkflows;\n        this.billCounter = 3;\n        this.workflowCounter = 3;\n    }\n    // Bill operations\n    createBill(billData) {\n        const bill = {\n            ...billData,\n            _id: this.billCounter.toString(),\n            createdAt: new Date(),\n            updatedAt: new Date()\n        };\n        this.bills.push(bill);\n        this.billCounter++;\n        return bill;\n    }\n    getBills(query = {}, options = {}) {\n        let filteredBills = [\n            ...this.bills\n        ];\n        // Apply search filter\n        if (query.$or) {\n            const searchTerms = query.$or;\n            filteredBills = filteredBills.filter((bill)=>searchTerms.some((term)=>{\n                    if (term.customerName) {\n                        return bill.customerName.toLowerCase().includes(term.customerName.$regex.toLowerCase());\n                    }\n                    if (term.phone) {\n                        return bill.phone.includes(term.phone.$regex);\n                    }\n                    return false;\n                }));\n        }\n        // Apply status filter\n        if (query.status) {\n            if (query.status.$in) {\n                filteredBills = filteredBills.filter((bill)=>query.status.$in.includes(bill.status));\n            } else if (query.status.$nin) {\n                filteredBills = filteredBills.filter((bill)=>!query.status.$nin.includes(bill.status));\n            }\n        }\n        // Sort by createdAt descending\n        filteredBills.sort((a, b)=>new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n        // Apply pagination\n        if (options.skip || options.limit) {\n            const skip = options.skip || 0;\n            const limit = options.limit || filteredBills.length;\n            filteredBills = filteredBills.slice(skip, skip + limit);\n        }\n        return filteredBills;\n    }\n    countBills(query = {}) {\n        return this.getBills(query).length;\n    }\n    getBillById(id) {\n        return this.bills.find((bill)=>bill._id === id) || null;\n    }\n    // Workflow operations\n    createWorkflow(workflowData) {\n        const workflow = {\n            ...workflowData,\n            _id: this.workflowCounter.toString(),\n            createdAt: new Date(),\n            updatedAt: new Date()\n        };\n        this.workflows.push(workflow);\n        this.workflowCounter++;\n        return workflow;\n    }\n    getWorkflows(query = {}) {\n        let filteredWorkflows = [\n            ...this.workflows\n        ];\n        if (query.stage) {\n            filteredWorkflows = filteredWorkflows.filter((workflow)=>workflow.stage === query.stage);\n        }\n        // Sort by updatedAt descending\n        filteredWorkflows.sort((a, b)=>new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n        return filteredWorkflows;\n    }\n    getWorkflowById(id) {\n        return this.workflows.find((workflow)=>workflow._id === id) || null;\n    }\n    updateWorkflow(id, updateData) {\n        const workflowIndex = this.workflows.findIndex((workflow)=>workflow._id === id);\n        if (workflowIndex === -1) return null;\n        this.workflows[workflowIndex] = {\n            ...this.workflows[workflowIndex],\n            ...updateData,\n            updatedAt: new Date()\n        };\n        return this.workflows[workflowIndex];\n    }\n    deleteWorkflow(id) {\n        const workflowIndex = this.workflows.findIndex((workflow)=>workflow._id === id);\n        if (workflowIndex === -1) return false;\n        // Get the workflow to find associated bill\n        const workflow = this.workflows[workflowIndex];\n        // Remove the workflow\n        this.workflows.splice(workflowIndex, 1);\n        // Remove associated bill if exists\n        if (workflow.billId) {\n            const billIndex = this.bills.findIndex((bill)=>bill._id === workflow.billId);\n            if (billIndex !== -1) {\n                this.bills.splice(billIndex, 1);\n            }\n        }\n        return true;\n    }\n    // Stats operations\n    getAdminStats() {\n        const totalCustomers = new Set(this.bills.map((bill)=>bill.customerName)).size;\n        const activeOrders = this.bills.filter((bill)=>![\n                \"completed\",\n                \"delivered\"\n            ].includes(bill.status)).length;\n        const completedOrders = this.bills.filter((bill)=>[\n                \"completed\",\n                \"delivered\"\n            ].includes(bill.status)).length;\n        const revenue = this.bills.reduce((sum, bill)=>sum + bill.subtotal, 0);\n        const workflowStages = this.workflows.reduce((acc, workflow)=>{\n            acc[workflow.stage] = (acc[workflow.stage] || 0) + 1;\n            return acc;\n        }, {});\n        const recentBills = this.getBills({}, {\n            limit: 5\n        });\n        return {\n            totalCustomers,\n            activeOrders,\n            completedOrders,\n            revenue,\n            recentBills,\n            workflowStages\n        };\n    }\n}\n// Export singleton instance\nconst mockDataStore = new MockDataStore();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUksQ0FBQ2hGLEtBQUssQ0FBQzJDLE1BQU0sQ0FBQ1QsQ0FBQUEsT0FBUSxDQUFDO2dCQUFDO2dCQUFhO2FBQVksQ0FBQ2EsUUFBUSxDQUFDYixLQUFLbkIsTUFBTSxHQUFHSSxNQUFNO1FBQ3hHLE1BQU04RCxrQkFBa0IsSUFBSSxDQUFDakYsS0FBSyxDQUFDMkMsTUFBTSxDQUFDVCxDQUFBQSxPQUFRO2dCQUFDO2dCQUFhO2FBQVksQ0FBQ2EsUUFBUSxDQUFDYixLQUFLbkIsTUFBTSxHQUFHSSxNQUFNO1FBQzFHLE1BQU0rRCxVQUFVLElBQUksQ0FBQ2xGLEtBQUssQ0FBQ21GLE1BQU0sQ0FBQyxDQUFDQyxLQUFLbEQsT0FBU2tELE1BQU1sRCxLQUFLdEIsUUFBUSxFQUFFO1FBRXRFLE1BQU15RSxpQkFBaUIsSUFBSSxDQUFDcEYsU0FBUyxDQUFDa0YsTUFBTSxDQUFDLENBQUNHLEtBQUt0QjtZQUNqRHNCLEdBQUcsQ0FBQ3RCLFNBQVNqQyxLQUFLLENBQUMsR0FBRyxDQUFDdUQsR0FBRyxDQUFDdEIsU0FBU2pDLEtBQUssQ0FBQyxJQUFJLEtBQUs7WUFDbkQsT0FBT3VEO1FBQ1QsR0FBRyxDQUFDO1FBRUosTUFBTUMsY0FBYyxJQUFJLENBQUNsRCxRQUFRLENBQUMsQ0FBQyxHQUFHO1lBQUVtQixPQUFPO1FBQUU7UUFFakQsT0FBTztZQUNMb0I7WUFDQUk7WUFDQUM7WUFDQUM7WUFDQUs7WUFDQUY7UUFDRjtJQUNGO0FBQ0Y7QUFFQSw0QkFBNEI7QUFDckIsTUFBTUcsZ0JBQWdCLElBQUkxRixnQkFBZ0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdGFyLXRhaWxvcnMvLi9zcmMvbGliL21vY2tEYXRhLnRzP2ZmZmQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gTW9jayBkYXRhIHN0b3JlIGZvciBkZXZlbG9wbWVudC90ZXN0aW5nIHdoZW4gTW9uZ29EQiBpcyBub3QgYXZhaWxhYmxlXHJcbmV4cG9ydCBpbnRlcmZhY2UgTW9ja0JpbGwge1xyXG4gIF9pZDogc3RyaW5nO1xyXG4gIGN1c3RvbWVyTmFtZTogc3RyaW5nO1xyXG4gIHBob25lOiBzdHJpbmc7XHJcbiAgZ2FybWVudFR5cGU6IHN0cmluZztcclxuICBxdWFudGl0eTogbnVtYmVyO1xyXG4gIHJhdGU6IG51bWJlcjtcclxuICBzdWJ0b3RhbDogbnVtYmVyO1xyXG4gIGFkdmFuY2U6IG51bWJlcjtcclxuICBiYWxhbmNlOiBudW1iZXI7XHJcbiAgc3RhdHVzOiAncGVuZGluZycgfCAnaW4tcHJvZ3Jlc3MnIHwgJ2NvbXBsZXRlZCcgfCAnZGVsaXZlcmVkJztcclxuICBkdWVEYXRlOiBEYXRlO1xyXG4gIG1lYXN1cmVtZW50czoge1xyXG4gICAgbGVuZ3RoPzogbnVtYmVyO1xyXG4gICAgc2hvdWxkZXI/OiBudW1iZXI7XHJcbiAgICBzbGVldmU/OiBudW1iZXI7XHJcbiAgICBjaGVzdD86IG51bWJlcjtcclxuICAgIHdhaXN0PzogbnVtYmVyO1xyXG4gICAgaGlwcz86IG51bWJlcjtcclxuICAgIGZyb250TmVjaz86IG51bWJlcjtcclxuICAgIGJhY2tOZWNrPzogbnVtYmVyO1xyXG4gIH07XHJcbiAgaW1hZ2VzPzogc3RyaW5nW107XHJcbiAgZHJhd2luZ3M/OiBzdHJpbmdbXTtcclxuICBjcmVhdGVkQXQ6IERhdGU7XHJcbiAgdXBkYXRlZEF0OiBEYXRlO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE1vY2tXb3JrZmxvdyB7XHJcbiAgX2lkOiBzdHJpbmc7XHJcbiAgYmlsbElkOiBzdHJpbmc7XHJcbiAgY3VzdG9tZXJOYW1lOiBzdHJpbmc7XHJcbiAgc3RhZ2U6ICdjdXR0aW5nJyB8ICdzdGl0Y2hpbmcnIHwgJ2ZpbmlzaGluZycgfCAncGFja2FnaW5nJyB8ICdkZWxpdmVyZWQnO1xyXG4gIGFzc2lnbmVkVG8/OiBzdHJpbmc7XHJcbiAgbm90ZXM/OiBzdHJpbmc7XHJcbiAgaW1hZ2VzPzogc3RyaW5nW107XHJcbiAgY3JlYXRlZEF0OiBEYXRlO1xyXG4gIHVwZGF0ZWRBdDogRGF0ZTtcclxufVxyXG5cclxuY2xhc3MgTW9ja0RhdGFTdG9yZSB7XHJcbiAgcHJpdmF0ZSBiaWxsczogTW9ja0JpbGxbXSA9IFtdO1xyXG4gIHByaXZhdGUgd29ya2Zsb3dzOiBNb2NrV29ya2Zsb3dbXSA9IFtdO1xyXG4gIHByaXZhdGUgYmlsbENvdW50ZXIgPSAxO1xyXG4gIHByaXZhdGUgd29ya2Zsb3dDb3VudGVyID0gMTtcclxuXHJcbiAgLy8gSW5pdGlhbGl6ZSB3aXRoIHNvbWUgc2FtcGxlIGRhdGFcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZVNhbXBsZURhdGEoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVNhbXBsZURhdGEoKSB7XHJcbiAgICAvLyBTYW1wbGUgYmlsbHNcclxuICAgIGNvbnN0IHNhbXBsZUJpbGxzOiBNb2NrQmlsbFtdID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgX2lkOiAnMScsXHJcbiAgICAgICAgY3VzdG9tZXJOYW1lOiAnSm9obiBEb2UnLFxyXG4gICAgICAgIHBob25lOiAnKzkxIDk4NzY1NDMyMTAnLFxyXG4gICAgICAgIGdhcm1lbnRUeXBlOiAnc2hpcnQnLFxyXG4gICAgICAgIHF1YW50aXR5OiAyLFxyXG4gICAgICAgIHJhdGU6IDgwMCxcclxuICAgICAgICBzdWJ0b3RhbDogMTYwMCxcclxuICAgICAgICBhZHZhbmNlOiA1MDAsXHJcbiAgICAgICAgYmFsYW5jZTogMTEwMCxcclxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICBkdWVEYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0xNScpLFxyXG4gICAgICAgIG1lYXN1cmVtZW50czoge1xyXG4gICAgICAgICAgbGVuZ3RoOiAzMCxcclxuICAgICAgICAgIHNob3VsZGVyOiAxOCxcclxuICAgICAgICAgIHNsZWV2ZTogMjQsXHJcbiAgICAgICAgICBjaGVzdDogNDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIGltYWdlczogW10sXHJcbiAgICAgICAgZHJhd2luZ3M6IFtdLFxyXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcclxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJylcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIF9pZDogJzInLFxyXG4gICAgICAgIGN1c3RvbWVyTmFtZTogJ0phbmUgU21pdGgnLFxyXG4gICAgICAgIHBob25lOiAnKzkxIDg3NjU0MzIxMDknLFxyXG4gICAgICAgIGdhcm1lbnRUeXBlOiAnZHJlc3MnLFxyXG4gICAgICAgIHF1YW50aXR5OiAxLFxyXG4gICAgICAgIHJhdGU6IDEyMDAsXHJcbiAgICAgICAgc3VidG90YWw6IDEyMDAsXHJcbiAgICAgICAgYWR2YW5jZTogNjAwLFxyXG4gICAgICAgIGJhbGFuY2U6IDYwMCxcclxuICAgICAgICBzdGF0dXM6ICdpbi1wcm9ncmVzcycsXHJcbiAgICAgICAgZHVlRGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMjAnKSxcclxuICAgICAgICBtZWFzdXJlbWVudHM6IHtcclxuICAgICAgICAgIGxlbmd0aDogNDIsXHJcbiAgICAgICAgICBjaGVzdDogMzYsXHJcbiAgICAgICAgICB3YWlzdDogMjgsXHJcbiAgICAgICAgICBoaXBzOiAzOFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaW1hZ2VzOiBbXSxcclxuICAgICAgICBkcmF3aW5nczogW10sXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMicpLFxyXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDInKVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG5cclxuICAgIC8vIFNhbXBsZSB3b3JrZmxvd3NcclxuICAgIGNvbnN0IHNhbXBsZVdvcmtmbG93czogTW9ja1dvcmtmbG93W10gPSBbXHJcbiAgICAgIHtcclxuICAgICAgICBfaWQ6ICcxJyxcclxuICAgICAgICBiaWxsSWQ6ICcxJyxcclxuICAgICAgICBjdXN0b21lck5hbWU6ICdKb2huIERvZScsXHJcbiAgICAgICAgc3RhZ2U6ICdjdXR0aW5nJyxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXHJcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBfaWQ6ICcyJyxcclxuICAgICAgICBiaWxsSWQ6ICcyJyxcclxuICAgICAgICBjdXN0b21lck5hbWU6ICdKYW5lIFNtaXRoJyxcclxuICAgICAgICBzdGFnZTogJ3N0aXRjaGluZycsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMicpLFxyXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDInKVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG5cclxuICAgIHRoaXMuYmlsbHMgPSBzYW1wbGVCaWxscztcclxuICAgIHRoaXMud29ya2Zsb3dzID0gc2FtcGxlV29ya2Zsb3dzO1xyXG4gICAgdGhpcy5iaWxsQ291bnRlciA9IDM7XHJcbiAgICB0aGlzLndvcmtmbG93Q291bnRlciA9IDM7XHJcbiAgfVxyXG5cclxuICAvLyBCaWxsIG9wZXJhdGlvbnNcclxuICBjcmVhdGVCaWxsKGJpbGxEYXRhOiBPbWl0PE1vY2tCaWxsLCAnX2lkJyB8ICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+KTogTW9ja0JpbGwge1xyXG4gICAgY29uc3QgYmlsbDogTW9ja0JpbGwgPSB7XHJcbiAgICAgIC4uLmJpbGxEYXRhLFxyXG4gICAgICBfaWQ6IHRoaXMuYmlsbENvdW50ZXIudG9TdHJpbmcoKSxcclxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcclxuICAgIH07XHJcbiAgICB0aGlzLmJpbGxzLnB1c2goYmlsbCk7XHJcbiAgICB0aGlzLmJpbGxDb3VudGVyKys7XHJcbiAgICByZXR1cm4gYmlsbDtcclxuICB9XHJcblxyXG4gIGdldEJpbGxzKHF1ZXJ5OiBhbnkgPSB7fSwgb3B0aW9uczogYW55ID0ge30pOiBNb2NrQmlsbFtdIHtcclxuICAgIGxldCBmaWx0ZXJlZEJpbGxzID0gWy4uLnRoaXMuYmlsbHNdO1xyXG5cclxuICAgIC8vIEFwcGx5IHNlYXJjaCBmaWx0ZXJcclxuICAgIGlmIChxdWVyeS4kb3IpIHtcclxuICAgICAgY29uc3Qgc2VhcmNoVGVybXMgPSBxdWVyeS4kb3I7XHJcbiAgICAgIGZpbHRlcmVkQmlsbHMgPSBmaWx0ZXJlZEJpbGxzLmZpbHRlcihiaWxsID0+IFxyXG4gICAgICAgIHNlYXJjaFRlcm1zLnNvbWUoKHRlcm06IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKHRlcm0uY3VzdG9tZXJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBiaWxsLmN1c3RvbWVyTmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0uY3VzdG9tZXJOYW1lLiRyZWdleC50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmICh0ZXJtLnBob25lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBiaWxsLnBob25lLmluY2x1ZGVzKHRlcm0ucGhvbmUuJHJlZ2V4KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwcGx5IHN0YXR1cyBmaWx0ZXJcclxuICAgIGlmIChxdWVyeS5zdGF0dXMpIHtcclxuICAgICAgaWYgKHF1ZXJ5LnN0YXR1cy4kaW4pIHtcclxuICAgICAgICBmaWx0ZXJlZEJpbGxzID0gZmlsdGVyZWRCaWxscy5maWx0ZXIoYmlsbCA9PiBxdWVyeS5zdGF0dXMuJGluLmluY2x1ZGVzKGJpbGwuc3RhdHVzKSk7XHJcbiAgICAgIH0gZWxzZSBpZiAocXVlcnkuc3RhdHVzLiRuaW4pIHtcclxuICAgICAgICBmaWx0ZXJlZEJpbGxzID0gZmlsdGVyZWRCaWxscy5maWx0ZXIoYmlsbCA9PiAhcXVlcnkuc3RhdHVzLiRuaW4uaW5jbHVkZXMoYmlsbC5zdGF0dXMpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNvcnQgYnkgY3JlYXRlZEF0IGRlc2NlbmRpbmdcclxuICAgIGZpbHRlcmVkQmlsbHMuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5jcmVhdGVkQXQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGEuY3JlYXRlZEF0KS5nZXRUaW1lKCkpO1xyXG5cclxuICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cclxuICAgIGlmIChvcHRpb25zLnNraXAgfHwgb3B0aW9ucy5saW1pdCkge1xyXG4gICAgICBjb25zdCBza2lwID0gb3B0aW9ucy5za2lwIHx8IDA7XHJcbiAgICAgIGNvbnN0IGxpbWl0ID0gb3B0aW9ucy5saW1pdCB8fCBmaWx0ZXJlZEJpbGxzLmxlbmd0aDtcclxuICAgICAgZmlsdGVyZWRCaWxscyA9IGZpbHRlcmVkQmlsbHMuc2xpY2Uoc2tpcCwgc2tpcCArIGxpbWl0KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmlsdGVyZWRCaWxscztcclxuICB9XHJcblxyXG4gIGNvdW50QmlsbHMocXVlcnk6IGFueSA9IHt9KTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmdldEJpbGxzKHF1ZXJ5KS5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICBnZXRCaWxsQnlJZChpZDogc3RyaW5nKTogTW9ja0JpbGwgfCBudWxsIHtcclxuICAgIHJldHVybiB0aGlzLmJpbGxzLmZpbmQoYmlsbCA9PiBiaWxsLl9pZCA9PT0gaWQpIHx8IG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyBXb3JrZmxvdyBvcGVyYXRpb25zXHJcbiAgY3JlYXRlV29ya2Zsb3cod29ya2Zsb3dEYXRhOiBPbWl0PE1vY2tXb3JrZmxvdywgJ19pZCcgfCAnY3JlYXRlZEF0JyB8ICd1cGRhdGVkQXQnPik6IE1vY2tXb3JrZmxvdyB7XHJcbiAgICBjb25zdCB3b3JrZmxvdzogTW9ja1dvcmtmbG93ID0ge1xyXG4gICAgICAuLi53b3JrZmxvd0RhdGEsXHJcbiAgICAgIF9pZDogdGhpcy53b3JrZmxvd0NvdW50ZXIudG9TdHJpbmcoKSxcclxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcclxuICAgIH07XHJcbiAgICB0aGlzLndvcmtmbG93cy5wdXNoKHdvcmtmbG93KTtcclxuICAgIHRoaXMud29ya2Zsb3dDb3VudGVyKys7XHJcbiAgICByZXR1cm4gd29ya2Zsb3c7XHJcbiAgfVxyXG5cclxuICBnZXRXb3JrZmxvd3MocXVlcnk6IGFueSA9IHt9KTogTW9ja1dvcmtmbG93W10ge1xyXG4gICAgbGV0IGZpbHRlcmVkV29ya2Zsb3dzID0gWy4uLnRoaXMud29ya2Zsb3dzXTtcclxuXHJcbiAgICBpZiAocXVlcnkuc3RhZ2UpIHtcclxuICAgICAgZmlsdGVyZWRXb3JrZmxvd3MgPSBmaWx0ZXJlZFdvcmtmbG93cy5maWx0ZXIod29ya2Zsb3cgPT4gd29ya2Zsb3cuc3RhZ2UgPT09IHF1ZXJ5LnN0YWdlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTb3J0IGJ5IHVwZGF0ZWRBdCBkZXNjZW5kaW5nXHJcbiAgICBmaWx0ZXJlZFdvcmtmbG93cy5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShiLnVwZGF0ZWRBdCkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS51cGRhdGVkQXQpLmdldFRpbWUoKSk7XHJcblxyXG4gICAgcmV0dXJuIGZpbHRlcmVkV29ya2Zsb3dzO1xyXG4gIH1cclxuXHJcbiAgZ2V0V29ya2Zsb3dCeUlkKGlkOiBzdHJpbmcpOiBNb2NrV29ya2Zsb3cgfCBudWxsIHtcclxuICAgIHJldHVybiB0aGlzLndvcmtmbG93cy5maW5kKHdvcmtmbG93ID0+IHdvcmtmbG93Ll9pZCA9PT0gaWQpIHx8IG51bGw7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVXb3JrZmxvdyhpZDogc3RyaW5nLCB1cGRhdGVEYXRhOiBQYXJ0aWFsPE1vY2tXb3JrZmxvdz4pOiBNb2NrV29ya2Zsb3cgfCBudWxsIHtcclxuICAgIGNvbnN0IHdvcmtmbG93SW5kZXggPSB0aGlzLndvcmtmbG93cy5maW5kSW5kZXgod29ya2Zsb3cgPT4gd29ya2Zsb3cuX2lkID09PSBpZCk7XHJcbiAgICBpZiAod29ya2Zsb3dJbmRleCA9PT0gLTEpIHJldHVybiBudWxsO1xyXG5cclxuICAgIHRoaXMud29ya2Zsb3dzW3dvcmtmbG93SW5kZXhdID0ge1xyXG4gICAgICAuLi50aGlzLndvcmtmbG93c1t3b3JrZmxvd0luZGV4XSxcclxuICAgICAgLi4udXBkYXRlRGF0YSxcclxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLndvcmtmbG93c1t3b3JrZmxvd0luZGV4XTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZVdvcmtmbG93KGlkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHdvcmtmbG93SW5kZXggPSB0aGlzLndvcmtmbG93cy5maW5kSW5kZXgod29ya2Zsb3cgPT4gd29ya2Zsb3cuX2lkID09PSBpZCk7XHJcbiAgICBpZiAod29ya2Zsb3dJbmRleCA9PT0gLTEpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAvLyBHZXQgdGhlIHdvcmtmbG93IHRvIGZpbmQgYXNzb2NpYXRlZCBiaWxsXHJcbiAgICBjb25zdCB3b3JrZmxvdyA9IHRoaXMud29ya2Zsb3dzW3dvcmtmbG93SW5kZXhdO1xyXG4gICAgXHJcbiAgICAvLyBSZW1vdmUgdGhlIHdvcmtmbG93XHJcbiAgICB0aGlzLndvcmtmbG93cy5zcGxpY2Uod29ya2Zsb3dJbmRleCwgMSk7XHJcbiAgICBcclxuICAgIC8vIFJlbW92ZSBhc3NvY2lhdGVkIGJpbGwgaWYgZXhpc3RzXHJcbiAgICBpZiAod29ya2Zsb3cuYmlsbElkKSB7XHJcbiAgICAgIGNvbnN0IGJpbGxJbmRleCA9IHRoaXMuYmlsbHMuZmluZEluZGV4KGJpbGwgPT4gYmlsbC5faWQgPT09IHdvcmtmbG93LmJpbGxJZCk7XHJcbiAgICAgIGlmIChiaWxsSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgdGhpcy5iaWxscy5zcGxpY2UoYmlsbEluZGV4LCAxKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8vIFN0YXRzIG9wZXJhdGlvbnNcclxuICBnZXRBZG1pblN0YXRzKCkge1xyXG4gICAgY29uc3QgdG90YWxDdXN0b21lcnMgPSBuZXcgU2V0KHRoaXMuYmlsbHMubWFwKGJpbGwgPT4gYmlsbC5jdXN0b21lck5hbWUpKS5zaXplO1xyXG4gICAgY29uc3QgYWN0aXZlT3JkZXJzID0gdGhpcy5iaWxscy5maWx0ZXIoYmlsbCA9PiAhWydjb21wbGV0ZWQnLCAnZGVsaXZlcmVkJ10uaW5jbHVkZXMoYmlsbC5zdGF0dXMpKS5sZW5ndGg7XHJcbiAgICBjb25zdCBjb21wbGV0ZWRPcmRlcnMgPSB0aGlzLmJpbGxzLmZpbHRlcihiaWxsID0+IFsnY29tcGxldGVkJywgJ2RlbGl2ZXJlZCddLmluY2x1ZGVzKGJpbGwuc3RhdHVzKSkubGVuZ3RoO1xyXG4gICAgY29uc3QgcmV2ZW51ZSA9IHRoaXMuYmlsbHMucmVkdWNlKChzdW0sIGJpbGwpID0+IHN1bSArIGJpbGwuc3VidG90YWwsIDApO1xyXG5cclxuICAgIGNvbnN0IHdvcmtmbG93U3RhZ2VzID0gdGhpcy53b3JrZmxvd3MucmVkdWNlKChhY2MsIHdvcmtmbG93KSA9PiB7XHJcbiAgICAgIGFjY1t3b3JrZmxvdy5zdGFnZV0gPSAoYWNjW3dvcmtmbG93LnN0YWdlXSB8fCAwKSArIDE7XHJcbiAgICAgIHJldHVybiBhY2M7XHJcbiAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KTtcclxuXHJcbiAgICBjb25zdCByZWNlbnRCaWxscyA9IHRoaXMuZ2V0QmlsbHMoe30sIHsgbGltaXQ6IDUgfSk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG90YWxDdXN0b21lcnMsXHJcbiAgICAgIGFjdGl2ZU9yZGVycyxcclxuICAgICAgY29tcGxldGVkT3JkZXJzLFxyXG4gICAgICByZXZlbnVlLFxyXG4gICAgICByZWNlbnRCaWxscyxcclxuICAgICAgd29ya2Zsb3dTdGFnZXNcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXHJcbmV4cG9ydCBjb25zdCBtb2NrRGF0YVN0b3JlID0gbmV3IE1vY2tEYXRhU3RvcmUoKTsiXSwibmFtZXMiOlsiTW9ja0RhdGFTdG9yZSIsImNvbnN0cnVjdG9yIiwiYmlsbHMiLCJ3b3JrZmxvd3MiLCJiaWxsQ291bnRlciIsIndvcmtmbG93Q291bnRlciIsImluaXRpYWxpemVTYW1wbGVEYXRhIiwic2FtcGxlQmlsbHMiLCJfaWQiLCJjdXN0b21lck5hbWUiLCJwaG9uZSIsImdhcm1lbnRUeXBlIiwicXVhbnRpdHkiLCJyYXRlIiwic3VidG90YWwiLCJhZHZhbmNlIiwiYmFsYW5jZSIsInN0YXR1cyIsImR1ZURhdGUiLCJEYXRlIiwibWVhc3VyZW1lbnRzIiwibGVuZ3RoIiwic2hvdWxkZXIiLCJzbGVldmUiLCJjaGVzdCIsImltYWdlcyIsImRyYXdpbmdzIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0Iiwid2Fpc3QiLCJoaXBzIiwic2FtcGxlV29ya2Zsb3dzIiwiYmlsbElkIiwic3RhZ2UiLCJjcmVhdGVCaWxsIiwiYmlsbERhdGEiLCJiaWxsIiwidG9TdHJpbmciLCJwdXNoIiwiZ2V0QmlsbHMiLCJxdWVyeSIsIm9wdGlvbnMiLCJmaWx0ZXJlZEJpbGxzIiwiJG9yIiwic2VhcmNoVGVybXMiLCJmaWx0ZXIiLCJzb21lIiwidGVybSIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCIkcmVnZXgiLCIkaW4iLCIkbmluIiwic29ydCIsImEiLCJiIiwiZ2V0VGltZSIsInNraXAiLCJsaW1pdCIsInNsaWNlIiwiY291bnRCaWxscyIsImdldEJpbGxCeUlkIiwiaWQiLCJmaW5kIiwiY3JlYXRlV29ya2Zsb3ciLCJ3b3JrZmxvd0RhdGEiLCJ3b3JrZmxvdyIsImdldFdvcmtmbG93cyIsImZpbHRlcmVkV29ya2Zsb3dzIiwiZ2V0V29ya2Zsb3dCeUlkIiwidXBkYXRlV29ya2Zsb3ciLCJ1cGRhdGVEYXRhIiwid29ya2Zsb3dJbmRleCIsImZpbmRJbmRleCIsImRlbGV0ZVdvcmtmbG93Iiwic3BsaWNlIiwiYmlsbEluZGV4IiwiZ2V0QWRtaW5TdGF0cyIsInRvdGFsQ3VzdG9tZXJzIiwiU2V0IiwibWFwIiwic2l6ZSIsImFjdGl2ZU9yZGVycyIsImNvbXBsZXRlZE9yZGVycyIsInJldmVudWUiLCJyZWR1Y2UiLCJzdW0iLCJ3b3JrZmxvd1N0YWdlcyIsImFjYyIsInJlY2VudEJpbGxzIiwibW9ja0RhdGFTdG9yZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/mockData.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/mongodb.ts":
/*!****************************!*\
  !*** ./src/lib/mongodb.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"Add MONGODB_URI to .env.local\");\nlet client;\nlet clientPromise;\nif (true) {\n    if (!global._mongoClientPromise) {\n        client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri);\n        global._mongoClientPromise = client.connect();\n    }\n    clientPromise = global._mongoClientPromise;\n} else {}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL21vbmdvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXNDO0FBRXRDLE1BQU1DLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVztBQUNuQyxJQUFJLENBQUNILEtBQUssTUFBTSxJQUFJSSxNQUFNO0FBRTFCLElBQUlDO0FBQ0osSUFBSUM7QUFFSixJQUFJTCxJQUF5QixFQUFlO0lBQzFDLElBQUksQ0FBQyxPQUFnQk8sbUJBQW1CLEVBQUU7UUFDeENILFNBQVMsSUFBSU4sZ0RBQVdBLENBQUNDO1FBQ3hCTyxPQUFlQyxtQkFBbUIsR0FBR0gsT0FBT0ksT0FBTztJQUN0RDtJQUNBSCxnQkFBZ0IsT0FBZ0JFLG1CQUFtQjtBQUNyRCxPQUFPLEVBR047QUFFRCxpRUFBZUYsYUFBYUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3N0YXItdGFpbG9ycy8uL3NyYy9saWIvbW9uZ29kYi50cz81M2MyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSSBhcyBzdHJpbmc7XHJcbmlmICghdXJpKSB0aHJvdyBuZXcgRXJyb3IoJ0FkZCBNT05HT0RCX1VSSSB0byAuZW52LmxvY2FsJyk7XHJcblxyXG5sZXQgY2xpZW50OiBNb25nb0NsaWVudDtcclxubGV0IGNsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+O1xyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgaWYgKCEoZ2xvYmFsIGFzIGFueSkuX21vbmdvQ2xpZW50UHJvbWlzZSkge1xyXG4gICAgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSk7XHJcbiAgICAoZ2xvYmFsIGFzIGFueSkuX21vbmdvQ2xpZW50UHJvbWlzZSA9IGNsaWVudC5jb25uZWN0KCk7XHJcbiAgfVxyXG4gIGNsaWVudFByb21pc2UgPSAoZ2xvYmFsIGFzIGFueSkuX21vbmdvQ2xpZW50UHJvbWlzZTtcclxufSBlbHNlIHtcclxuICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpKTtcclxuICBjbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xpZW50UHJvbWlzZTsiXSwibmFtZXMiOlsiTW9uZ29DbGllbnQiLCJ1cmkiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9VUkkiLCJFcnJvciIsImNsaWVudCIsImNsaWVudFByb21pc2UiLCJnbG9iYWwiLCJfbW9uZ29DbGllbnRQcm9taXNlIiwiY29ubmVjdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/mongodb.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fbilling%2Froute&page=%2Fapi%2Fbilling%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fbilling%2Froute.ts&appDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cakash%5COneDrive%5CDesktop%5CStar&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();